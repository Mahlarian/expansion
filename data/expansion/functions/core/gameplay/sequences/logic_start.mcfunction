# this handles scheduling the loops
schedule clear expansion:core/gameplay/craft_detector
schedule function expansion:core/gameplay/craft_detector 10t
schedule function expansion:core/gameplay/items/score_checker 1t
# this handles spawnref
#
# this part specifically handles worldspawn
# originally, this killed all players and then relied on their spawn being at world spawn. One, this is inconsistent
# if the player had set their spawnpoint elsehwere, but also it flat out didn't work. An easier method was found which
# was to just let the server make the border_marker entity, which will spawn the entity at world spawn
execute if score spawn_ref exp_data matches 1 run summon area_effect_cloud ~ ~ ~ {Duration:2147483647,Tags:["border_marker"]}
# this part specifically handles 0,0
execute if score spawn_ref exp_data matches 2 run spreadplayers 0 0 0 1 true @a
# teleports players to bordermarker
execute if entity @e[limit=1,type=area_effect_cloud,tag=border_marker] as @e[type=area_effect_cloud,tag=border_marker,limit=1] run tp @a @s
# creates the border
execute as @e[limit=1,tag=border_marker,type=area_effect_cloud] at @s run worldborder center ~ ~
execute unless entity @e[tag=border_marker,type=area_effect_cloud] run worldborder center 0 0
execute unless entity @e[tag=border_marker,type=area_effect_cloud] run spreadplayers 0 0 1 1 false @a
execute as @a run spawnpoint @a ~ ~ ~
worldborder warning distance 8
worldborder warning time 3
worldborder set 64 0
execute store result score blocks blocks run worldborder get
# bossbar handling
bossbar add expansion:timer {"text":"placeholder"}
execute if score difficulty exp_data matches 1..2 run bossbar set expansion max 1800
execute if score difficulty exp_data matches 1..2 run scoreboard players set bar exp_timer 1800
execute if score difficulty exp_data matches 3 run bossbar set expansion max 1440
execute if score difficulty exp_data matches 3 run scoreboard players set bar exp_timer 1440
execute if score difficulty exp_data matches 4..5 run bossbar set expansion max 1200
execute if score difficulty exp_data matches 4..5 run scoreboard players set bar exp_timer 1200
# starts gameloop
execute if score grace_period exp_data matches 1 run scoreboard players set grace_m exp_timer 10
execute if score grace_period exp_data matches 1 run scoreboard players set grace_bar exp_timer 600
execute if score grace_period exp_data matches 1 run bossbar set expansion:timer players @a
execute if score grace_period exp_data matches 1 run bossbar set expansion:timer max 600
execute if score grace_period exp_data matches 1 run bossbar set expansion:timer color green
execute if score grace_period exp_data matches 1 run scoreboard players set grace_s exp_timer 0
execute if score grace_period exp_data matches 1 run function expansion:core/gameplay/grace_timer
execute if score grace_period exp_data matches 0 run function expansion:core/gameplay/timer
# sets gamestate to active
scoreboard players set game_state exp_data 2
# other stuff
give @a minecraft:written_book{display:{Name:'{"text":"Expansion Handbook","color":"light_purple"}',Lore:['{"text":"The starter\'s guide to Expansion","color":"white","italic":true}']},title:"",author:"",pages:['[{"text":"   Table of Contents\\n\\n","color":"gray"},{"text":" Click to jump to that\\n","color":"dark_gray"},{"text":"         section\\n\\n","color":"dark_gray"},{"text":"1] Starter Guide\\n","color":"blue"},{"text":"2] Items and Recipes\\n","color":"blue","clickEvent":{"action":"change_page","value":"14"}},{"text":"3] Credits","color":"blue"}]','[{"text":"      Starter Guide\\n\\n","color":"blue"},{"text":"Welcome to Expansion! Expansion is a new gamemode that is all about making use of the time you are given to expand your playing area before the border outshrinks you! All players are given a 64x64 area to share. If you\'re just starting out, it\'s","color":"gray"}]','[{"text":"recommended that you play on ","color":"gray"},{"text":"Medium ","color":"gold"},{"text":"with ","color":"gray"},{"text":"grace period","color":"light_purple"},{"text":" on","color":"green"},{"text":" for your first time. If you struggle, ","color":"gray"},{"text":"Easy","color":"gold"},{"text":" has been designed to help make Expansion enjoyable for players who want to enjoy  their world at a slower pace.\\n\\n Cores are new items added by Expansion that can be crafted and used to expand ","color":"gray"}]','[{"text":"your area. Cores are crafted using Iron, Gold, Diamond, Emerald, and Netherite. Each material is different, and depending on the quality of the material will decide how much area you will expand with the core. To use a core, hold the core in your hand and  ","color":"gray"},{"text":"RCLICK.","color":"light_purple"}]','[{"text":"On the subject of crafting...\\n\\n","color":"dark_gray","italic":true},{"text":"Crafting works a little different in Expansion. Instead of using a normal crafting table, items are crafted through a system called floor-crafting. To craft an item, drop the recipe on the ground anywhere, and make sure that all the","color":"gray","italic":false}]','{"text":"the materials are within a block of each other, and that you have exactly the right amount of items. This is done to ensure accidental crafting doesn\'t happen. Recipes that are correct will instantly convert themselves into the crafted item! Pretty neat stuff.","color":"gray"}','[{"text":"Don\'t forget the basics of Minecraft!\\n\\n","color":"dark_gray","italic":true},{"text":"Hunger remains unchanged in Expansion. Because of your limited area, animals are a luxury, so it is essential that you start with a crop farm immediately if you want a food source. It\'s hard to be quick on your toes on an","color":"gray","italic":false}]','[{"text":"empty stomach.\\n\\n","color":"gray"},{"text":"Torches","color":"gold"},{"text":" will be a very critical part of your journey. Remember that because you\'re in a small area, enemies will not have many places to spawn, and can easily swamp you at night or in dark areas if you\'re not careful. You\'ll want to ensure you light up","color":"gray"}]','{"text":"dark areas to prevent this. Good news is, because these areas are small, you won\'t need to spend a lot of time placing torches! Don\'t neglect them though, or you will regret it.","color":"gray"}','[{"text":"About the big guy...\\n\\n","color":"dark_gray","italic":true},{"text":"The border has several safety premeasures to ensure you won\'t die to \'bugs\'. One of these is when you approach the border, getting within 8 blocks of the border will cause a red tint around the edges of your screen. This tint will","color":"gray","italic":false}]','{"text":"intensify the closer you are to it. A large progress bar and timer are shown at the top of your screen with remaining time between shrinks, and a 10 second warning will sound when the border is about to shrink. Should you get stuck during a shrink, you are allowed to be ","color":"gray"}','{"text":"outside of the border by 5 blocks before you\'ll take damage. Any further than this and you will begin to suffocate. The further away you are from the playing area, the faster you\'ll die, so be careful! Do note that being outside of the border you won\'t be able to break blocks or ","color":"gray"}','[{"text":"interact with the world in any way.\\n\\n\\n\\n\\n\\n","color":"gray"},{"text":"That covers the basics of Expansion! Good luck on your journey, and happy expanding!","color":"gray"}]','[{"text":"   Items and Recipes","color":"blue"},{"text":"\\n\\nHover over an item to view its info\\n\\n","color":"dark_gray"},{"text":"Iron Core\\n","color":"aqua","hoverEvent":{"action":"show_text","contents":[{"text":"One of the several cores to expand the playing area.\\n"},{"text":"RCLICK ","color":"light_purple"},{"text":"to use.","color":"white"},{"text":"\\n\\nRecipe:\\n8 iron ingot\\n2 wooden plank\\n1 coal\\n\\nStats:\\n"},{"text":"- Easy: "},{"text":"+14 blocks ","color":"green"},{"text":"/"},{"text":" +2 minutes","color":"green"},{"text":"\\n- Medium:"},{"text":" +10 blocks","color":"green"},{"text":" /"},{"text":" +1 minute","color":"green"},{"text":"\\n- Hard: ","color":"white"},{"text":"+8 blocks","color":"green"},{"text":"\\n- Expert: "},{"text":"+6 blocks","color":"green"},{"text":"\\n- Hardcore:","color":"white"},{"text":" +6 blocks","color":"green"},{"text":" /"},{"text":" -6 minutes","color":"red"}]}},{"text":"Gold Core\\n","color":"aqua","hoverEvent":{"action":"show_text","contents":[{"text":"One of the several cores to expand the playing area.\\n","color":"white"},{"text":"RCLICK","color":"light_purple"},{"text":" to use.\\n\\n"},{"text":"Recipe:\\n8 gold ingot\\n2 redstone\\n1 redstone torch\\n\\n"},{"text":"Stats:\\n- Easy: "},{"text":"+24 blocks ","color":"green"},{"text":"/"},{"text":" +5 minutes","color":"green"},{"text":"\\n- Medium: "},{"text":"+18 blocks ","color":"green"},{"text":"/"},{"text":" +3 minutes\\n","color":"green"},{"text":"- Hard:"},{"text":" +14 blocks\\n","color":"green"},{"text":"- Expert:"},{"text":" +12 blocks\\n","color":"green"},{"text":"- Hardcore:"},{"text":" +10 blocks ","color":"green"},{"text":"/"},{"text":" -4 minutes","color":"red"}]}},{"text":"Diamond Core\\n","color":"aqua","hoverEvent":{"action":"show_text","contents":[{"text":"One of the several cores to expand the playing area.\\n","color":"white"},{"text":"RCLICK","color":"light_purple"},{"text":" to use.\\n\\n"},{"text":"Recipe:\\n8 diamond\\n2 quartz block\\n1 redstone lamp\\n\\n"},{"text":"Stats:\\n- Easy: "},{"text":"+32 blocks ","color":"green"},{"text":"/"},{"text":" +12 minutes","color":"green"},{"text":"\\n- Medium: "},{"text":"+26 blocks ","color":"green"},{"text":"/"},{"text":" +8 minutes\\n","color":"green"},{"text":"- Hard:"},{"text":" +24 blocks\\n","color":"green"},{"text":"- Expert:"},{"text":" +20 blocks\\n","color":"green"},{"text":"- Hardcore:"},{"text":" +18 blocks ","color":"green"},{"text":"/"},{"text":" -2 minutes","color":"red"}]}},{"text":"Emerald Core\\n","color":"aqua","hoverEvent":{"action":"show_text","contents":[{"text":"One of the several cores to expand the playing area.\\n","color":"white"},{"text":"RCLICK","color":"light_purple"},{"text":" to use.\\n\\n"},{"text":"Recipe:\\n8 emerald\\n4 gold ingot\\n1 daylight detector\\n\\n"},{"text":"Stats:\\n- Easy: "},{"text":"+54 blocks ","color":"green"},{"text":"/"},{"text":" +20 minutes","color":"green"},{"text":"\\n- Medium: "},{"text":"+42 blocks ","color":"green"},{"text":"/"},{"text":" +12 minutes\\n","color":"green"},{"text":"- Hard:"},{"text":" +36 blocks\\n","color":"green"},{"text":"- Expert:"},{"text":" +32 blocks\\n","color":"green"},{"text":"- Hardcore:"},{"text":" +30 blocks ","color":"green"},{"text":"/"},{"text":" -8 minutes","color":"red"}]}},{"text":"Netherite Core\\n","color":"aqua","hoverEvent":{"action":"show_text","contents":[{"text":"One of the several cores to expand the playing area.\\n","color":"white"},{"text":"RCLICK","color":"light_purple"},{"text":" to use.\\n\\n"},{"text":"Recipe:\\n8 netherite\\n2 iron block\\n1 clock\\n\\n"},{"text":"Stats:\\n- Easy: "},{"text":"+112 blocks ","color":"green"},{"text":"/"},{"text":" +50 minutes","color":"green"},{"text":"\\n- Medium: "},{"text":"+88 blocks ","color":"green"},{"text":"/"},{"text":" +25 minutes\\n","color":"green"},{"text":"- Hard:"},{"text":" +82 blocks\\n","color":"green"},{"text":"- Expert:"},{"text":" +76 blocks\\n","color":"green"},{"text":"- Hardcore:"},{"text":" +68 blocks ","color":"green"}]}},{"text":"Flaregun\\n","color":"aqua","hoverEvent":{"action":"show_text","contents":[{"text":"Firing it will allow you to end Expansion.\\n"},{"text":"RCLICK ","color":"light_purple"},{"text":"to use.","color":"white"},{"text":"\\n\\nRecipe:\\n1 iron\\n1 coal\\n1 flint"}]}},{"text":"Expansion Handbook","color":"aqua","hoverEvent":{"action":"show_text","contents":[{"text":"An in-game wiki for Expansion."},{"text":"\\n\\nRecipe:\\n1 book\\n1 clock"}]}}]']}